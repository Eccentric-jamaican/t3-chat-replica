@import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Poppins:wght@400;500;600;700&display=swap");
@import "tailwindcss";

@theme {
  --color-primary: #a23b67;
  --color-background: #f2e1f4;
  --color-foreground: #501854;

  /* Exact Sendcat Colors & Spaces */
  --color-t3-lavender: oklab(0.87 0.06 -0.03);
  --color-t3-berry-light: oklab(0.7 0.15 -0.05);
  --color-t3-berry: oklab(0.55 0.16 -0.08);
  --color-t3-berry-deep: oklab(0.44 0.11 -0.08);

  --color-t3-banner-bg: rgb(254, 235, 231);
  --color-t3-banner-text: rgb(80, 24, 84);

  /* Animation Tokens */
  --animate-in: animate-in 0.2s ease-out;
  --animate-out: animate-out 0.15s ease-in;
  --animate-pulse-slow: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

:root {
  /* Visual Viewport (Keyboard) Height - managed by useVisualViewport hook */
  --visual-viewport-bottom: 0px;
  --visual-viewport-height: 100dvh;
}

@keyframes pulse-slow {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.85;
    transform: scale(0.98);
  }
}

@layer components {
  /* Sophisticated Reflective Border */
  .border-reflect {
    position: relative;
    /* Mobile: moderate blur with solid-ish background */
    background: rgba(242, 225, 244, 0.88);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* Slightly more blur on desktop where it works better */
  @media (min-width: 768px) {
    .border-reflect {
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      background: rgba(242, 225, 244, 0.82);
    }
  }

  /* The 1px Glowing Edge using Mask-Composite */
  .border-reflect::before {
    content: "";
    position: absolute;
    inset: 0;
    padding: 1px; /* The border width */
    border-radius: inherit;
    background: linear-gradient(
      180deg,
      rgba(80, 24, 84, 0.05),
      rgba(80, 24, 84, 0.1),
      rgba(80, 24, 84, 0.05)
    );
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
  }

  /* Specific glow for the input box */
  .input-glow {
    box-shadow:
      0 0 0 1px rgba(80, 24, 84, 0.03),
      0 1px 1px rgba(0, 0, 0, 0.02),
      0 4px 12px rgba(80, 24, 84, 0.04);
  }

  .glass-pill {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    transition-property: all;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 200ms;
    border: 0.8px solid oklab(0.44 0.11 -0.08 / 0.1);
    background: transparent;
    color: var(--color-t3-berry-deep);
    font-weight: 600;
    font-size: 13px;
  }

  .glass-pill:hover {
    background: rgba(80, 24, 84, 0.04);
  }
}

@layer base {
  /* Mobile viewport height fix - use dvh with vh fallback */
  html {
    height: 100%;
    height: 100dvh;
    overflow: hidden;
  }

  body {
    background-color: var(--color-background);
    color: var(--color-foreground);
    overflow: hidden;
    width: 100%;
    max-width: 100vw;
    height: 100%;
    min-height: 100vh;
    font-family:
      "Poppins",
      system-ui,
      -apple-system,
      sans-serif;
    touch-action: none; /* Only allow scrolling on elements that specifically enable it */
  }

  @supports (min-height: 100dvh) {
    body {
      min-height: 100dvh;
    }
  }

  /* Specific elements that MUST be scrollable */
  .message-scroll-area,
  .sidebar-scroll-area,
  [data-radix-scroll-area-viewport] {
    touch-action: pan-y;
  }

  body::selection {
    background-color: color-mix(in srgb, var(--color-primary) 20%, transparent);
    color: var(--color-primary);
  }
}

/* Atmosphere: Edge Glows */
.edge-glow-top {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  height: 200px;
  background: radial-gradient(
    circle at center top,
    rgba(255, 255, 255, 0.4) 0%,
    transparent 70%
  );
  pointer-events: none;
  z-index: 10;
  filter: blur(40px);
}

.edge-glow-bottom {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  height: 200px;
  background: radial-gradient(
    circle at center bottom,
    rgba(255, 255, 255, 0.3) 0%,
    transparent 70%
  );
  pointer-events: none;
  z-index: 10;
  filter: blur(40px);
}

.bg-noise {
  position: fixed;
  inset: 0;
  z-index: 5;
  pointer-events: none;
  opacity: 0.03;
  background-image: url("https://Sendcat/images/noise.png");
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

/* Markdown Prose Styles */
.prose {
  font-size: 16px; /* Aligned with Sendcat */
  line-height: 1.75; /* 28px perfectly */
  letter-spacing: -0.01em;
  color: var(--color-foreground);
  font-weight: 400; /* Sendcat uses regular weight */
}

.prose h1,
.prose h2,
.prose h3 {
  color: var(--color-foreground);
  font-weight: 700;
  margin-top: 1.25em; /* Slightly reduced margins for tighter hierarchy */
  margin-bottom: 0.5em;
  letter-spacing: -0.02em;
}

.prose p {
  margin-bottom: 1.25em;
}

.prose strong {
  font-weight: 600; /* Aligned with Sendcat inspection */
  color: var(--color-foreground);
}

.prose ul,
.prose ol {
  margin-bottom: 1.25em;
  padding-left: 1.5em;
}

.prose li {
  margin-bottom: 0.5em;
}

.prose table {
  width: 100%;
  border-collapse: collapse;
  margin: 2em 0;
}

.prose th,
.prose td {
  padding: 0.85em;
  border: 1px solid rgba(80, 24, 84, 0.08);
  text-align: left;
}

.prose th {
  background: rgba(80, 24, 84, 0.03);
  font-weight: 650;
  font-size: 0.9em;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.prose blockquote {
  border-left: 3px solid var(--color-t3-berry);
  padding-left: 1.25em;
  font-style: italic;
  color: var(--color-t3-berry-deep);
  margin: 2em 0;
  opacity: 0.85;
}

.prose pre {
  background: #000 !important;
  border-radius: 0.75rem;
  padding: 0 !important;
}

/* Syntax Highlighting Tweaks */
.hljs {
  background: transparent !important;
}

/* Streaming Message Optimizations */
.streaming-content {
  will-change: contents;
  contain: layout style paint;
  transform: translateZ(0);
}

/* Streaming text animation */
.animated-streaming-text {
  position: relative;
}

/* Prevent scroll anchor jumps during streaming */
.message-scroll-area {
  overflow-anchor: none;
  overscroll-behavior-y: contain;
  -webkit-overflow-scrolling: touch;
}

/* Keep scroll position stable */
.message-anchor {
  overflow-anchor: auto;
  height: 1px;
}
